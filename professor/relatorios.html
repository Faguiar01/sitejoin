<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat칩rios - Join Xperience</title>
    
    <!-- CSS otimizado -->
    <link rel="stylesheet" href="../assets/css/professor-styles.css">
    <link rel="stylesheet" href="../assets/css/reports.css">
    
    <!-- Pr칠-conex칫es para melhor performance -->
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- Biblioteca Chart.js para gr치ficos futuros -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
</head>
<body class="flex-body">
    <header class="main-header">
        <a href="../index.html" class="logo-container">
            <img src="../assets/images/JOIN.png" alt="Logo Join Xperience" loading="lazy">
            <span>Join Xperience</span>
        </a>
        <nav>
            <button id="logout-button" class="btn-logout">Sair</button>
        </nav>
    </header>

    <main class="container">
        <div class="page-header">
            <h1>Relat칩rios de Desempenho</h1>
            <div>
                <a href="professor.html" class="btn btn-primary">Voltar ao Painel</a>
            </div>
        </div>

        <div class="reports-grid" id="reports-container">
            <!-- Os cards ser칚o gerados dinamicamente via JavaScript -->
            <div class="loading-message">
                <p>Carregando relat칩rios...</p>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <p>춸 <span id="current-year">2025</span> JOIN XPERIENCE - Todos os direitos reservados</p>
    </footer>

    <!-- Scripts otimizados -->
    <script type="module">
        // Importa칞칫es otimizadas
        import { auth, db } from '../assets/js/firebase-init.js';
        import { signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        import { showAlert } from '../assets/js/form-utils.js';

        // Dados dos relat칩rios
        const REPORTS_DATA = [
            {
                id: 'current-round',
                title: 'Resultados da Rodada Atual',
                description: 'Os dados desta se칞칚o estar칚o dispon칤veis ap칩s o fechamento da rodada atual.',
                icon: '游늵',
                available: false
            },
            {
                id: 'ranking',
                title: 'Ranking Geral de Equipes',
                description: 'Um ranking de rentabilidade e valor de mercado ser치 exibido aqui.',
                icon: '游끥',
                available: false
            },
            {
                id: 'history',
                title: 'Hist칩rico de Desempenho',
                description: 'Gr치ficos mostrando a evolu칞칚o das equipes ao longo das rodadas aparecer칚o nesta 치rea.',
                icon: '游늳',
                available: false
            },
            {
                id: 'student-analysis',
                title: 'An치lise Individual por Aluno',
                description: 'Uma vis칚o detalhada das decis칫es e resultados de cada aluno ser치 implementada futuramente.',
                icon: '游녻',
                available: false
            }
        ];

        // Inicializa칞칚o quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();
            document.getElementById('current-year').textContent = new Date().getFullYear();
        });

        // Controle de autentica칞칚o
        function initAuth() {
            onAuthStateChanged(auth, (user) => {
                if (user && user.email.endsWith('@escola.com')) {
                    document.body.style.display = 'flex';
                    loadReports();
                } else {
                    window.location.href = '../login.html';
                }
            });

            // Configura칞칚o do logout
            document.getElementById('logout-button').addEventListener('click', async (e) => {
                e.preventDefault();
                try {
                    await signOut(auth);
                    window.location.href = '../index.html';
                } catch (error) {
                    console.error('Erro ao fazer logout:', error);
                    showAlert('Ocorreu um erro ao tentar sair.', 'error');
                }
            });
        }

        // Carrega os relat칩rios
        function loadReports() {
            const container = document.getElementById('reports-container');
            container.innerHTML = '';
            
            REPORTS_DATA.forEach(report => {
                const card = document.createElement('div');
                card.className = `report-card ${report.available ? '' : 'disabled'}`;
                card.id = `report-${report.id}`;
                
                card.innerHTML = `
                    <div class="report-card-header">
                        <div class="report-icon">${report.icon}</div>
                        <h3>${report.title}</h3>
                    </div>
                    <div class="report-card-body">
                        <p>${report.description}</p>
                        ${report.available ? 
                            '<button class="btn btn-primary view-report-btn">Ver Relat칩rio</button>' : 
                            '<div class="coming-soon">Em breve</div>'}
                    </div>`;
                
                container.appendChild(card);
            });

            // Adiciona evento de clique para relat칩rios dispon칤veis
            document.querySelectorAll('.view-report-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reportId = this.closest('.report-card').id.replace('report-', '');
                    viewReport(reportId);
                });
            });
        }

        // Visualizar relat칩rio (implementa칞칚o futura)
        function viewReport(reportId) {
            console.log(`Visualizando relat칩rio: ${reportId}`);
            // Implementa칞칚o futura para carregar dados espec칤ficos do relat칩rio
        }
    </script>
</body>
</html>