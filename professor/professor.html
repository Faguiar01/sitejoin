<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Professor - Join Xperience</title>
    
    <!-- CSS otimizado -->
    <link rel="stylesheet" href="../assets/css/professor-styles.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    
    <!-- PrÃ©-conexÃµes para melhor performance -->
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>
<body class="flex-body">
    <header class="main-header">
        <a href="../index.html" class="logo-container">
            <img src="../assets/images/JOIN.png" alt="Logo Join Xperience" loading="lazy">
            <span>Join Xperience</span>
        </a>
        <nav>
            <button id="logout-button" class="btn-logout">Sair</button>
        </nav>
    </header>

    <main>
        <div class="dashboard-header">
            <h1 id="welcome-title">Painel do Professor</h1>
            <p id="welcome-message">A verificar autenticaÃ§Ã£o...</p>
            <div class="actions">
                <button id="open-post-modal-btn" class="btn btn-success" disabled>ðŸ“° Nova Postagem no Mural</button>
            </div>
        </div>
        
        <div class="container">
            <div class="dashboard-grid" id="dashboard-grid">
                <a href="bussola.html" class="card">
                    <div class="icon">ðŸ§­</div>
                    <h3>BÃºssola</h3>
                    <p>Aceda ao glossÃ¡rio de termos e conceitos do jogo.</p>
                </a>
                <a href="gerenciar-turmas.html" class="card">
                    <div class="icon">ðŸ‘¥</div>
                    <h3>Gerir Turmas</h3>
                    <p>Crie, organize e acompanhe o progresso das suas turmas.</p>
                </a>
                <a href="relatorios.html" class="card">
                    <div class="icon">ðŸ“Š</div>
                    <h3>RelatÃ³rios</h3>
                    <p>Visualize relatÃ³rios detalhados e insights sobre as rodadas.</p>
                </a>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <p>Â© <span id="current-year">2025</span> JOIN XPERIENCE - Todos os direitos reservados</p>
    </footer>

    <script type="module">
        // ImportaÃ§Ãµes otimizadas
        import { auth, db } from '../assets/js/firebase-init.js';
        import { signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        import { showAlert } from '../assets/js/form-utils.js';

        // InicializaÃ§Ã£o quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();
            document.getElementById('current-year').textContent = new Date().getFullYear();
        });

        // Controle de autenticaÃ§Ã£o
        function initAuth() {
            onAuthStateChanged(auth, async (user) => {
                if (user && user.email.endsWith('@escola.com')) {
                    document.body.style.display = 'flex';
                    await loadUserData(user);
                } else {
                    window.location.href = '../login.html';
                }
            });

            // ConfiguraÃ§Ã£o do logout
            document.getElementById('logout-button').addEventListener('click', async (e) => {
                e.preventDefault();
                try {
                    await signOut(auth);
                    window.location.href = '../login.html';
                } catch (error) {
                    console.error('Erro ao fazer logout:', error);
                    showAlert('Ocorreu um erro ao tentar sair.', 'error');
                }
            });
        }

        // Carrega os dados do professor
        async function loadUserData(user) {
            const welcomeTitle = document.getElementById('welcome-title');
            const welcomeMessage = document.getElementById('welcome-message');
            
            try {
                const userDocRef = doc(db, "usuarios", user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    welcomeTitle.textContent = `Bem-vindo(a), ${userData.nome || 'Professor(a)'}!`;
                    
                    // Adiciona painel de admin se for administrador
                    if (userData.isAdmin) {
                        addAdminPanel();
                    }
                }
                
                welcomeMessage.textContent = 'Use as ferramentas abaixo para gerir o jogo, acompanhar as suas turmas e ver relatÃ³rios.';
                
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
                welcomeTitle.textContent = 'Painel do Professor';
                welcomeMessage.textContent = 'NÃ£o foi possÃ­vel carregar seus dados.';
                showAlert('Erro ao carregar informaÃ§Ãµes do usuÃ¡rio.', 'error');
            }
        }

        // Adiciona card do painel de admin se necessÃ¡rio
        function addAdminPanel() {
            const grid = document.getElementById('dashboard-grid');
            grid.insertAdjacentHTML('beforeend', `
                <a href="../adm/index.html" class="card">
                    <div class="icon">ðŸ‘‘</div>
                    <h3>Painel do Administrador</h3>
                    <p>Aceda Ã s ferramentas de gestÃ£o do jogo (CatÃ¡logo, CenÃ¡rios, etc.).</p>
                </a>
            `);
        }
    </script>
</body>
</html>